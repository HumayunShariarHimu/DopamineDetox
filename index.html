<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dopamine Detox</title>
<meta name="description" content="A calm, minimal interface to detox your mind from digital overstimulation.">
<meta name="author" content="Humayun Shariar Himu">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<style>
  /* ----------- Base Style ----------- */
  :root {
    --bg: #0b0b0b;
    --card: #141414;
    --border: #1f1f1f;
    --text: #e2e2e2;
    --muted: #888;
    --accent: #9acd32;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: "Inter", sans-serif;
    background: var(--bg);
    color: var(--text);
    letter-spacing: 0.3px;
    line-height: 1.6;
    overflow-x: hidden;
    transition: background 0.4s;
  }

  header {
    text-align: center;
    padding: 40px 10px 20px;
    border-bottom: 1px solid var(--border);
  }

  header h1 {
    font-size: 1.6em;
    font-weight: 600;
    letter-spacing: 1px;
    color: var(--accent);
    margin-bottom: 5px;
  }

  header p {
    font-size: 0.9em;
    color: var(--muted);
  }

  /* ----------- PDF Section ----------- */
  #pdfContainer {
    max-width: 850px;
    margin: 40px auto;
    padding: 0 10px 80px;
  }

  .pdfCard {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    margin-bottom: 35px;
    box-shadow: 0 0 30px rgba(0,0,0,0.3);
    transition: 0.3s ease;
  }

  .pdfCard:hover {
    transform: translateY(-3px);
    box-shadow: 0 0 40px rgba(0,0,0,0.5);
  }

  .pdfTitle {
    text-align: center;
    background: transparent;
    padding: 15px;
    font-size: 1em;
    font-weight: 500;
    color: var(--accent);
    border-bottom: 1px solid var(--border);
  }

  .pdfCanvas {
    width: 100%;
    display: block;
    background: #0e0e0e;
  }

  .loading {
    text-align: center;
    font-size: 0.85em;
    color: var(--muted);
    padding: 15px;
    font-style: italic;
  }

  footer {
    text-align: center;
    font-size: 0.8em;
    color: var(--muted);
    padding: 20px;
    border-top: 1px solid var(--border);
  }

  /* ----------- Smooth Scroll & Minimal Animations ----------- */
  html {
    scroll-behavior: smooth;
  }

  @media (max-width: 600px) {
    header h1 {
      font-size: 1.3em;
    }
  }
</style>
</head>

<body>
  <header>
    <h1>Dopamine Detox</h1>
    <p>Deep Focus Library for Calm Minds</p>
  </header>

  <div id="pdfContainer">
    <div class="loading">Preparing your calm reading space...</div>
  </div>

  <footer>Dopamine DetoxüïØÔ∏è Humayun Shariar Himu</footer>

  <script>
    const username = "HumayunShariarHimu";
    const repo = "DopamineDetox";
    const branch = "main";
    const pageBatch = 5;

    async function loadRepoFiles() {
      const container = document.getElementById("pdfContainer");
      try {
        const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/`);
        if (!res.ok) throw new Error("GitHub API Error");
        const data = await res.json();
        const pdfFiles = data.filter(f => f.name.toLowerCase().endsWith(".pdf"));

        if (!pdfFiles.length) {
          container.innerHTML = `<div class="loading">No PDF files found.</div>`;
          return;
        }

        container.innerHTML = "";
        for (const [i, file] of pdfFiles.entries()) {
          const pdfUrl = `https://raw.githubusercontent.com/${username}/${repo}/${branch}/${file.name}`;
          await renderPdfCard(pdfUrl, file.name, i, container);
        }
      } catch (err) {
        container.innerHTML = `<div class="loading">Error loading repository: ${err.message}</div>`;
        console.error(err);
      }
    }

    async function renderPdfCard(url, name, index, container) {
      const card = document.createElement("div");
      card.className = "pdfCard";
      card.innerHTML = `<div class="pdfTitle">${name.replace(".pdf","")}</div>
                        <div class="loading" id="load${index}">Loading PDF...</div>`;
      container.appendChild(card);

      try {
        const pdf = await pdfjsLib.getDocument(url).promise;
        const totalPages = pdf.numPages;
        const loading = document.getElementById(`load${index}`);

        let loadedPages = 0;

        async function loadNextBatch() {
          const start = loadedPages + 1;
          const end = Math.min(loadedPages + pageBatch, totalPages);
          for (let p = start; p <= end; p++) {
            const page = await pdf.getPage(p);
            const viewport = page.getViewport({ scale: 1.2 });
            const canvas = document.createElement("canvas");
            canvas.className = "pdfCanvas";
            const ctx = canvas.getContext("2d");
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            card.appendChild(canvas);
            await page.render({ canvasContext: ctx, viewport }).promise;
          }
          loadedPages = end;
          if (loadedPages >= totalPages) {
            loading.remove();
            window.removeEventListener('scroll', onScroll);
          }
        }

        await loadNextBatch();

        function onScroll() {
          const rect = card.getBoundingClientRect();
          if (rect.bottom - window.innerHeight < 100 && loadedPages < totalPages) {
            loadNextBatch();
          }
        }

        window.addEventListener('scroll', onScroll);

      } catch (err) {
        document.getElementById(`load${index}`).textContent = "Error Loading PDF.";
        console.error(err);
      }
    }

    loadRepoFiles();
  </script>
</body>
</html>
